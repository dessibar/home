<!DOCTYPE html> 
<html class="home-bg">

<head>
  <title>DESSIBAR Project</title>
  <style>
      #map {
        position:center;
        height: 400px;
        width: 50%;
      }
  </style>
  <meta http-equiv="content-type" content="text/html; charset=windows-1252" />
  <link rel="stylesheet" type="text/css" href="css/style.css" />
  <!-- modernizr enables HTML5 elements and feature detects -->
  <script type="text/javascript" src="js/jquery.js"></script>
  <!-- <script type="text/javascript" src="js/modernizr-1.5.min.js"></script> -->

</head>

<body>
  
  

   <h1>Icelandic and Barents Sea Stock Visualization Tool</h1>
	 
   <p id="acousticText"></p>
   <button onclick="loadXMLDoc()">Generate Map</button>
   <div id="map"></div>
	
   <script>
	   
     function initMap(){
        var options = {
            zoom:6,
            center:{lat:62.641066,lng:-12.704159}
        }  
         
        var infowindow = new google.maps.InfoWindow(); 
        map = new google.maps.Map(document.getElementById('map'), options);
        
        google.maps.event.addListenerOnce(map, 'idle', function(){
        jQuery('.gm-style-iw').prev('div').remove();
        }); 
		
     }	   
	   
	function loadXMLDoc() {
	console.log("LOAD XML DOC FUNCTION");
  	var xmlhttp = new XMLHttpRequest();
	xmlhttp.open("GET", "/home/acoustics/example.xml", true);
	xmlhttp.send();
  	xmlhttp.onreadystatechange = function() {
	 console.log("ReadyState: " + this.readyState);
	 console.log("Status: " + this.status);
   	 if (this.readyState == 4 && this.status == 200) {
   	   myFunction(this);
  	  }
 	 }; 
	}
	   
	function myFunction(xml) {
	console.log("ENTRO A LA FUNCION");
  	var stockNumber, latLng, distanceArray, latData, lonData, saData, i, j, xmlDoc, txt;
 	xmlDoc = xml.responseXML;
	console.log(xml.responseXML);
  	txt = "";
	
  	distanceArray = xmlDoc.getElementsByTagName("distance");
		
	/*
	this.parentNode.getAttribute("acocat")
	*/

  	for (i = 0; i < distanceArray.length; i++) {
  	  latData = distanceArray[i].getElementsByTagName("lat_start");
	  console.log(latData[0].childNodes[0].nodeValue);
	  lonData = distanceArray[i].getElementsByTagName("lon_start");
	  console.log(lonData[0].childNodes[0].nodeValue);
   	  saData = distanceArray[i].getElementsByTagName("sa");
	
	  for (j = 0; j < saData.length; j++) {
	    if (saData[j].childNodes[0].parentNode.getAttribute("acocat") == "16") {
		console.log("EUREKA!!!");    
		stocknumber = saData[j].childNodes[0].nodeValue;
	    }
	    console.log(saData[j].childNodes[0].parentNode.nodeName);	  
	  }
		
	  
		
	  
		
	  latLng = {
           lat: Number(latData[0].childNodes[0].nodeValue),
           lng: Number(lonData[0].childNodes[0].nodeValue)
          };
		
	  var capelinImage = {
            url: 'https://raw.githubusercontent.com/dessibar/home/master/images/capelin-green-tilted.png',
            scaledSize: new google.maps.Size(30, 30)
          }
	  
          addMarker(stocknumber,capelinImage,latLng);
	  console.log("MARKER ADDED! Index: " + i);
		
	}
		
	document.getElementById("acousticText").innerHTML = txt;
	
     }

	   
	function addMarker(stock,image,latLng){
          var marker = new google.maps.Marker({
            position:latLng,
            icon:image,
            map:map
          });	
		
	}
	 
	/*	
	
	
	  
        
          var content = '<div id="content">'+
          '<div id="bodyContent">'+
          '<div id="positionContent"><p>Position: ' + String(latLng['lat']) + ", " + String(latLng['lng']) + '</p></div>' +
          '<div id="stockContent"><p>Capelin Stock: ' + stock + '</p></div>' 
          '</div>'+
          '</div>';                     
        
          google.maps.event.addListener(marker,'click', (function(marker,content,infowindow){ 
             return function() {
             infowindow.setContent(content);
             infowindow.open(map,this);
             };  
						       
        	
		
        $infoWindowContent.width($infoWindowContent.width());
        })(marker,content,infowindow));
	
	
   
           google.maps.event.addListener(marker, 'click', function() {
              infowindow.open(map,marker);
           });
           // Event that closes the Info Window with a click on the map
              google.maps.event.addListener(map, 'click', function() {
              infowindow.close();
              });  
     	   }
      
      
      */
	  

  	 
  	   
	   
   </script>


   <script async defer 
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD27I7bId1Hmqthv5gTTh15GKAgkiFM538&callback=initMap">
      </script>
  
</body>
</html>
